# 📋 版本号管理指南

## 🎯 自动版本检查已启用！

本项目已设置 **Git Pre-commit Hook** 自动检查版本号更新。

---

## 📍 版本号位置

**文件**: `app.py`  
**行号**: 第 55 行  
**格式**: `vYYYY.MM.DD.序号`

```python
st.caption("Version: v2026.01.29.01")
```

---

## 🚀 推荐工作流程

### ✅ 正确流程

```bash
# 1. 修改代码
# （修改 app.py 或其他文件）

# 2. 更新版本号（如果修改了 app.py）
# 编辑 app.py 第 55 行，更新为今天日期
# v2026.01.29.01 → v2026.01.29.02（同一天多次更新）

# 3. 添加到暂存区
git add .

# 4. 提交（自动触发版本检查）
git commit -m "feat: 添加籌碼面提醒功能"

# 输出示例：
# ========================================
# 🔍 检查版本号更新...
# ========================================
# ✓ 检测到 app.py 有变更
# 📌 当前版本号: 2026.01.29.01
# 📅 今天日期: 2026.01.29
# ✅ 版本号已更新为今天日期！
# ========================================
# ✅ Pre-commit 检查完成！
# ========================================

# 5. 推送到远程
git push origin main
```

### ⚠️ 忘记更新版本号时

```bash
git commit -m "fix: 修复bug"

# 输出示例：
# ========================================
# ⚠️  警告：版本号可能未更新！
# ========================================
# 当前版本: v2026.01.22.01
# 建议版本: v2026.01.29.XX
# 位置: app.py 第 55 行
#
# 是否继续提交？(y/n)

# 👉 输入 n：取消提交，返回修改版本号
# 👉 输入 y：强制继续（不推荐）
```

---

## 📊 Hook 工作原理

### 触发条件
- **仅当 `app.py` 被修改时** 才检查版本号
- 如果只修改其他文件，**自动跳过检查**

### 检查逻辑
1. 检测 `app.py` 是否在本次提交中
2. 提取当前版本号（正则匹配）
3. 获取今天日期
4. 对比版本号是否包含今天日期
5. 根据结果显示提示或警告

### 智能判断
- ✅ `v2026.01.29.01` → 通过（版本号是今天）
- ✅ `v2026.01.29.02` → 通过（同一天多个版本）
- ⚠️ `v2026.01.22.01` → 警告（不是今天的日期）

---

## 🔧 高级用法

### 临时跳过检查

```bash
# 使用 --no-verify 跳过所有 Git Hooks
git commit -m "临时提交" --no-verify
```

### 查看 Hook 日志

```bash
# Hook 文件位置
cat .git/hooks/pre-commit

# 查看 Hook 说明
cat .git/hooks/VERSION_HOOK_README.md
```

### 禁用 Hook

```bash
# 方法 1: 删除 hook 文件
rm .git/hooks/pre-commit

# 方法 2: 重命名（保留备份）
mv .git/hooks/pre-commit .git/hooks/pre-commit.bak
```

### 恢复 Hook

```bash
# 如果不小心删除，可以从备份恢复
mv .git/hooks/pre-commit.bak .git/hooks/pre-commit
```

---

## 💡 版本号命名规则

### 基本格式
```
vYYYY.MM.DD.序号
```

### 示例
```python
v2026.01.29.01  # 2026年1月29日第1版
v2026.01.29.02  # 2026年1月29日第2版（同一天多次发布）
v2026.02.01.01  # 2026年2月1日第1版
```

### 何时递增序号？
- **新的一天**：重置序号为 `.01`
- **同一天多次更新**：递增序号 `.01` → `.02` → `.03`

---

## ❓ 常见问题

### Q1: Hook 为什么不生效？

**检查清单**：
1. 确认文件名为 `pre-commit`（无 `.sh` 或其他扩展名）
2. 确认文件位置在 `.git/hooks/` 目录下
3. 在 Windows 上，确保使用 Git Bash 或 Git for Windows

### Q2: 修改了其他文件，也会检查版本号吗？

**不会**。Hook 只在 `app.py` 被修改时才检查版本号。

### Q3: 团队其他成员也会自动检查吗？

**不会**。Git Hooks 只在本地生效，不会推送到远程仓库。  
团队成员需要各自复制 hook 文件到自己的 `.git/hooks/` 目录。

### Q4: 我可以自定义检查规则吗？

**可以**。编辑 `.git/hooks/pre-commit` 文件，修改检查逻辑。  
例如：修改版本号格式、调整提示文字等。

---

## 🎉 成功案例

```bash
$ git commit -m "feat: 新增籌碼面更新时间提醒"

========================================
🔍 检查版本号更新...
========================================
✓ 检测到 app.py 有变更
📌 当前版本号: 2026.01.29.01
📅 今天日期: 2026.01.29
✅ 版本号已更新为今天日期！
========================================
✅ Pre-commit 检查完成！
========================================

[main abc1234] feat: 新增籌碼面更新时间提醒
 1 file changed, 5 insertions(+), 2 deletions(-)
```

---

## 📚 相关文档

- **Hook 详细说明**: `.git/hooks/VERSION_HOOK_README.md`
- **Hook 源代码**: `.git/hooks/pre-commit`
- **版本号位置**: `app.py` 第 55 行

---

## 🆘 需要帮助？

如果遇到问题或需要调整 Hook 行为，可以：
1. 查看 `.git/hooks/VERSION_HOOK_README.md`
2. 编辑 `.git/hooks/pre-commit` 自定义规则
3. 联系项目维护者

---

**最后更新**: 2026-01-29  
**Hook 版本**: v1.0
